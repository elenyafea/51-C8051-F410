/* 3310液晶显示屏C51测试程序 2004/07/31/BD2YA 
接脚资料： Pin Signal Description Port
 1:VDD Power Input. Logic supply voltage range VDD to GND : 2.7 to 3.3 V
 2:SCLK Serial clock. Input for the clock signal: 0.0 to 4.0 Mbits/s.
 3:SDIN Serial data. Input for the data line.
 4/C Mode Select. To select either command/address or data input.
 5:SCE Chip enable input. The enable pin allows data to be clocked in. The signal is active LOW.
 6:GND Ground
 7:VOUT Ouptut voltage. Add external 1-10 uF electrolytic capacitor from VOUT to GND
 8:RES External reset. This signal will reset the device and must be applied to properly initialize the chip. The signal is active LOW.
   控制芯片： PCD8544 */

#include <reg51.h>
#define uchar unsigned char
#define uint unsigned int 
sbit sdin=P1^3; //数据
sbit sclk=P1^4; //时钟
sbit dc=P1^2;   //1写数据，0写指令 
sbit sce=P1^1;  //片选 
sbit res=P1^0;  //复位,0复位

void write_command(uchar dd)//写一位命令 
{ 
	char i;      
	sce=0;
	dc=0; 
	for(i=7;i>=0;i--) 
		{ 
		sdin=(dd>>i)&1; 
		sclk=0;
		sclk=1; 
		} 
	dc=1; 
	sce=1; 
	sdin=1; 
}

void write_sdina(char d)    //写1位数据 
{ 
	char i; 
	sce=0; 
	for(i=7;i>=0;i--) 
		{ 
		sdin=(d>>i)&1; 
		sclk=0; 
		sclk=1; 
		} 
	sce=1; 
	sdin=1; 
}

void setadd(char a,char d)  //设定地址 
{ 
	uchar madx[8];
	uchar mady[8]; 
	char i; 
	char j; 
	for(i=0;i<3;i++) 
		{ 
		madx[i]=d%2; 
		d=d/2; 
		} 
	madx[3]=0; 
	madx[4]=0; 
	madx[5]=0; 
	madx[6]=1; 
	madx[7]=0; 
	sce=0; 
	dc=0; 
	for(j=7;j>=0;j--) 
		{ 
		sdin=madx[j]; 
		sclk=0; 
		sclk=1; 
		} 
	dc=1; 
	sdin=1; 
	sce=1; 
	for(j=0;j<7;j++) 
		{ 
		mady[j]=a%2; 
		a=a/2; 
		} 
	mady[7]=1; 
	sce=0; 
	dc=0; 
	for(j=7;j>=0;j--) 
		{ 
		sdin=mady[j]; 
		sclk=0; 
		sclk=1; 
		} 
	dc=1; 
	sdin=1; 
	sce=1; 
} 

void qp()//清屏
{ 
	uchar t; 
	uchar k; 
	uint d; 
	d=0; 
	for(t=0;t<6;t++) 
		{ 
		for(k=0;k<84;k++) 
			{ 
			setadd(k,t); 
			write_sdina(0);
			d=d+1; 
			if(d>504)
				d=d-504; 
			} 
		} 
}

uchar code dal[]= { 
/*源文件 / 文字 : E:\3310\1\qq.bmp模 ; 宽×高（像素）: 84×48 ; 
字模格式/大小 : 单色点阵液晶字模，纵向取模，字节倒序/504字节 ; 
数据转换日期 : 2004-7-30 13:40:24 */ 
0x00,0x00,0x02,0xFA,0x8A,0x8A,0x8A,0xFA,0x02,0x02,0xFE,0x03,0x02,0x00,0x40,0x4F, 0xC9,0x79,
0x49,0xCF,0x00,0xFC,0x00,0x00,0xFF,0x00,0x02,0x82,0x02,0xBE,0x22,0x63, 0xA2,0x22,0x22,0xA2,
0x02,0x00,0x00,0x01,0x01,0x01,0x01,0xF9,0x09,0x05,0x03,0x01, 0x00,0x00,0x10,0x14,0x14,0x94,
0xD4,0xBF,0x94,0x5C,0x54,0x12,0x10,0x00,0x00,0xFF, 0x29,0x29,0xFF,0x00,0xFF,0x29,0x29,0xFF,
0x00,0x00,0x04,0x04,0x04,0xC4,0x3F,0xD4, 0x14,0x94,0x74,0x06,0x00,0x00,0x00,0x01,0x00,0x00,
0x00,0x01,0x04,0x04,0x07,0x00, 0x00,0x00,0x04,0x02,0x01,0x04,0x04,0x03,0x00,0x01,0x04,0x04,
0x07,0x00,0x02,0x01, 0x00,0x07,0x04,0x04,0x05,0x04,0x06,0x00,0x03,0x00,0x00,0x80,0x40,0x44,
0x84,0x07, 0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x92,0x51,0x30,0x37,0x14,0x14,0x14,0x04,0x07, 
0x00,0x00,0x26,0x21,0x44,0x84,0x07,0x02,0x01,0x04,0x04,0x07,0x00,0x00,0x04,0x02, 0x05,0x04,
0x04,0x02,0x01,0x02,0x02,0x04,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x30,0x48,0x88,0x10,
0x60,0x78,0x04,0x04,0xF8,0x00,0x00,0x00,0x00,0x00,0x1C,0xE2, 0x02,0x04,0x08,0x04,0x84,0x84,
0x82,0x02,0x02,0x02,0x01,0x81,0x41,0x21,0x21,0x20, 0x00,0x04,0x07,0x18,0x60,0x80,0x00,0x00,
0xF0,0x0C,0x03,0x00,0xFC,0x00,0x00,0x04, 0x0E,0x04,0xC0,0x60,0x62,0x37,0x12,0x90,0x16,0x19,
0x7A,0xFC,0xF8,0xF0,0x80,0x40, 0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x07,0x08,0x10,0xE0,0x00,0x00,0x00,0xF8,0x07,
0x00,0x00, 0x02,0x12,0x12,0x1F,0xF4,0xA0,0x00,0x00,0x00,0x40,0x80,0x81,0x8C,0x5C,0x3C,0x2C, 
0x40,0x40,0x40,0x20,0x00,0x00,0x80,0xC0,0x64,0x5F,0x45,0xC9,0x83,0x04,0x04,0x04, 0x1B,0x20,
0x40,0x80,0x80,0x01,0x00,0x00,0x00,0x00,0x10,0x14,0x23,0x21,0xA1,0x51, 0xF1,0x3F,0x12,0xE2,
0x40,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00,0x00,0x00,0x00,0x00,0x00,
0x00,0x00,0x00,0x00,0x00,0x00,0x03,0x0C,0x10,0x20, 0x21,0x22,0x22,0x22,0x7F,0x41,0x41,0x47,
0x49,0xCB,0x0F,0x06,0x06,0x04,0x0C,0x1C, 0x14,0x34,0x24,0x24,0x14,0x14,0x12,0x0A,0x06,0x01,
0x00,0x00,0x00,0x00,0xE0,0x20, 0x2F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x01,0x01,
0x01,0x01,0x01,0x01, 0x01,0x01,0x00,0x00,0xF8,0x21,0x21,0x40,0x40,0x20,0xD1,0x8A,0x0C,0x10,
0x20,0xC0, 0x00,0x00,0x00,0x00,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20, 
0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x1F,0x20, 0x00,0x20,
0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20, 0x00,0x20,0x07,0x38,
0x00,0x3F,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20,0x00,0x20, 0x00,0x20,0x00,0x20,0x00,0x20,
0x00,0x20,0x07,0x38,0x04,0x22,0x01,0x31,0x10,0x28, 0x08,0x24,0x04,0x23,0x00,0x20,0x00,0x20};

uint ftoc(uint degc)//取数据 
{ 
return dal[degc]; 
}

void main(void)//主程序 
{ 
uint t; uchar k; uint d; uchar e; 
res=0;res=0;res=0; res=1; sce=1; sdin=1; sclk=1; 
write_command(0x21);//初始化Lcd,功能设定使用扩充指令 
write_command(0xd3);//设定液晶偏置电压(高--低） 
write_command(0x20);//使用基本指令 
write_command(0x0C);//设定显示模式，正常显示 
do 
	{ 
	qp();//清屏 
	for(t=0;t<40000;t++);//延时 
	d=0; //写一屏图 
	for(t=0;t<6;t++) 
		{ 
		for(k=0;k<84;k++) 
			{ 
			e=ftoc(d); 
			setadd(k,t); 
			write_sdina(e); 
			d=d+1; //
			if(d>504)
			d=d-504; 
			} 
		} 
	for(t=0;t<40000;t++);//延时 
	} 
	while(1);
}

